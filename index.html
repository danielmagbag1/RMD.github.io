<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rule Model Design</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <div class="container">
        <header class="hero">
             <h1>Rule Model Design</h1>
            <p class="subtitle">Build conditions (rules), test facts, and drive process flow (finite state machine) in one place.</p>
        </header>

        <section class="concept">
            <article class="concept-card">
                <h3>1. Rules</h3>
                <p>A rule checks one fact. Example: <code>amount &gt; 1000</code>.</p>
            </article>
            <article class="concept-card">
                <h3>2. Evaluation</h3>
                <p>Send a facts JSON object. The system returns which rules matched.</p>
            </article>
            <article class="concept-card">
                <h3>3. FSM</h3>
                <p>States move only through allowed events, like <code>idle --submit--&gt; review</code>.</p>
            </article>
        </section>

        <div class="workspace">
            <section class="panel">
                <div class="panel-title">
                    <h2>Step 1: Create Rules</h2>
                    <p class="panel-help">Lower priority number runs earlier.</p>
                </div>

                <div class="row">
                    <div>
                        <label for="ruleName">Rule Name</label>
                        <input id="ruleName" placeholder="High amount check" />
                    </div>
                    <div>
                        <label for="ruleField">Field</label>
                        <input id="ruleField" placeholder="amount" />
                    </div>
                </div>
                <div class="row">
                    <div>
                        <label for="ruleOperator">Operator</label>
                        <select id="ruleOperator">
                            <option>==</option>
                            <option>!=</option>
                            <option>&gt;</option>
                            <option>&lt;</option>
                            <option>&gt;=</option>
                            <option>&lt;=</option>
                            <option>contains</option>
                            <option>in</option>
                        </select>
                    </div>
                    <div>
                        <label for="rulePriority">Priority</label>
                        <input id="rulePriority" type="number" value="100" />
                    </div>
                </div>
                <div class="row single">
                    <div>
                        <label for="ruleValue">Value</label>
                        <input id="ruleValue" placeholder="1000 or &quot;urgent&quot; or [1,2,3]" />
                    </div>
                </div>
                <div class="row">
                    <button id="addRuleBtn">Add Rule</button>
                    <button id="refreshRulesBtn" class="secondary">Refresh Rules</button>
                </div>
                <ul id="rulesList" class="list"></ul>
                <div id="rulesOutput" class="output"></div>
            </section>

            <section class="panel">
                <div class="panel-title">
                    <h2>Step 2: Evaluate Facts</h2>
                    <p class="panel-help">Use valid JSON input, then evaluate and review matched rules.</p>
                </div>
                <label for="factsInput">Facts JSON</label>
                <textarea id="factsInput">{
  "amount": 1200,
  "status": "urgent",
  "tags": ["vip", "priority"]
}</textarea>
                <div class="row">
                    <button id="evaluateBtn">Evaluate</button>
                    <button id="sampleFactsBtn" class="secondary">Load Sample Facts</button>
                </div>

                <h3>Matched Rules</h3>
                <ul id="matchedRulesList" class="list"></ul>

                <div class="row single">
                    <button id="toggleDetailsBtn" class="secondary" disabled>View Details JSON (Run Evaluate First)</button>
                </div>
                <div id="evaluateOutput" class="output hidden"></div>
            </section>
        </div>

        <div class="workspace single-column">
            <section class="panel">
                <div class="panel-title">
                    <h2>Step 3: Manage Finite State Machine</h2>
                    <p class="panel-help">Trigger an event to move from current state to next state.</p>
                </div>
                <div class="row">
                    <div>
                        <label for="eventInput">Trigger Event</label>
                        <input id="eventInput" placeholder="submit" />
                    </div>
                    <div>
                        <label>&nbsp;</label>
                        <button id="triggerEventBtn">Apply Event</button>
                    </div>
                </div>
                <div class="row single">
                    <div>
                        <label for="eventFromState">Apply From State (Optional)</label>
                        <select id="eventFromState">
                            <option value="">Use current state</option>
                        </select>
                    </div>
                </div>

                <h3>Add Transition</h3>
                <div class="row">
                    <div>
                        <label for="fromState">From State</label>
                        <input id="fromState" placeholder="idle" />
                    </div>
                    <div>
                        <label for="transitionEvent">Event</label>
                        <input id="transitionEvent" placeholder="submit" />
                    </div>
                </div>
                <div class="row">
                    <div>
                        <label for="toState">To State</label>
                        <input id="toState" placeholder="review" />
                    </div>
                    <div>
                        <label>&nbsp;</label>
                        <button id="addTransitionBtn" class="secondary">Add Transition</button>
                    </div>
                </div>
                <div class="row">
                    <button id="refreshFsmBtn" class="secondary">Refresh FSM</button>
                    <button id="resetFsmBtn" class="danger">Reset FSM</button>
                </div>

                <div id="fsmSummary" class="summary"></div>
                <div id="fsmAvailableEvents" class="summary"></div>

                <div class="fsm-grid">
                    <section class="fsm-card">
                        <h3>State Colors</h3>
                        <div id="fsmStateLegend" class="state-legend"></div>
                    </section>

                    <section class="fsm-card visual-card">
                        <h3>FSM Visual</h3>
                        <div id="fsmVisual" class="fsm-visual"></div>
                    </section>

                    <section class="fsm-card">
                        <div class="fsm-card-header">
                            <h3>Transitions</h3>
                            <button id="clearTransitionsBtn" class="danger mini-action" type="button">Delete All</button>
                        </div>
                        <ul id="fsmTransitionList" class="list compact"></ul>
                    </section>

                    <section class="fsm-card">
                        <div class="fsm-card-header">
                            <h3>Recent History</h3>
                            <button id="clearHistoryBtn" class="secondary mini-action" type="button">Clear History</button>
                        </div>
                        <ul id="fsmHistoryList" class="list compact"></ul>
                    </section>
                </div>

                <div id="fsmOutput" class="output"></div>
            </section>
        </div>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>
